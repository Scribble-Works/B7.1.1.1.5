<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metric Mastery üìê - Unit Conversion & Rounding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles and Animations */
        .feedback {
            padding: 8px;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }

        .success {
            background-color: #D1FAE5;
            /* Green 100 */
            color: #065F46;
            /* Green 800 */
        }

        .error {
            background-color: #FEE2E2;
            /* Red 100 */
            color: #991B1B;
            /* Red 800 */
        }

        .value-display {
            font-size: 3.5rem;
            font-weight: 700;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-2xl">

        <header class="text-center mb-6">
            <h1 class="text-4xl font-extrabold text-teal-700 tracking-tight mb-2">
                Metric Mastery üìê
            </h1>
            <p class="text-lg text-gray-600">Convert the length and round the result!</p>
        </header>

        <div class="grid grid-cols-3 gap-4 text-center mb-8 font-semibold">
            <div class="bg-green-100 p-3 rounded-lg border-2 border-green-300">
                Score: <span id="score" class="text-xl text-green-800">0</span>
            </div>
            <div class="bg-red-100 p-3 rounded-lg border-2 border-red-300">
                Lives: <span id="lives" class="text-xl text-red-800">3</span>
            </div>
            <div class="bg-yellow-100 p-3 rounded-lg border-2 border-yellow-300">
                Time: <span id="timer" class="text-xl text-yellow-800">00:20</span>
            </div>
        </div>

        <div id="gameArea" class="hidden">

            <div class="text-center mb-4">
                <span id="levelBadge"
                    class="inline-block bg-teal-500 text-white text-sm font-bold px-3 py-1 rounded-full shadow-md">Level
                    1</span>
            </div>

            <div class="bg-gray-50 p-6 rounded-xl shadow-inner border-2 border-gray-200 mb-6">
                <p class="text-xl font-medium text-gray-700 mb-3 text-center" id="taskText">
                    Convert 1.234 meters to centimeters, rounded to 2 decimal places.
                </p>
                <div class="text-center p-4 bg-white rounded-lg border">
                    <span id="originalNumber" class="font-mono text-gray-800 value-display">
                        12.5 m
                    </span>
                </div>
                <p class="text-md text-gray-500 mt-3 text-center">
                    **Note:** Do not include units (cm, mm, etc.) in your answer.
                </p>
            </div>

            <div class="flex flex-col space-y-3">
                <input type="text" id="answer" placeholder="Your converted and rounded number..."
                    class="w-full text-2xl p-3 border-2 border-gray-300 rounded-lg focus:border-teal-500 focus:ring-teal-500 transition-colors font-mono">

                <div id="feedback" class="feedback">Click Start Game!</div>

                <div class="flex space-x-3 mt-4">
                    <button id="submitBtn"
                        class="flex-grow bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-md text-xl disabled:opacity-50">
                        Submit Answer
                    </button>
                    <button id="hintBtn"
                        class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg shadow-md text-xl disabled:opacity-50">
                        Hint (-5 pts)
                    </button>
                    <button id="skipBtn"
                        class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg shadow-md text-xl disabled:opacity-50">
                        Skip (-10 pts)
                    </button>
                </div>
            </div>
        </div>

        <div id="modalStart" class="text-center p-8">
            <h2 class="text-3xl font-bold text-teal-600 mb-4">Master Metric Conversions!</h2>
            <p class="text-gray-600 mb-6">Convert the given length to the target unit, then round the result to the
                required decimal place within the time limit.</p>
            <button id="startBtn"
                class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 px-12 rounded-lg shadow-xl text-2xl transition-colors">
                Start Game
            </button>
        </div>

        <div class="hidden text-center p-4 border-t mt-6 pt-6" id="modal">
            <button id="restartBtn"
                class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg text-xl transition-colors">
                Restart Game
            </button>
        </div>

    </div>

    <div id="levelPopup"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center">
            <h3 class="text-4xl font-extrabold text-green-600 mb-2">LEVEL UP! ‚¨ÜÔ∏è</h3>
            <p class="text-xl text-gray-700 mb-4">You've reached Level <span class="font-bold text-2xl"
                    id="popupNextLevel"></span>!</p>
            <p class="text-lg text-gray-600 mb-6">Current Score: <span class="font-extrabold text-indigo-600"
                    id="popupScore">0</span></p>
            <button id="popupNext"
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow-md text-lg transition-colors">
                Continue to Next Level
            </button>
        </div>
    </div>

    <script>
        // Metric Mastery ‚Äî COMPLETE GAME LOGIC
        (() => {
            // === CONSTANTS: Conversion Factors (to Meters) ===
            const CONVERSION_FACTORS = {
                'km': 1000,
                'm': 1,
                'cm': 0.01,
                'mm': 0.001
            };
            const UNITS = Object.keys(CONVERSION_FACTORS);

            // === ELEMENT REFERENCES ===
            const originalEl = document.getElementById('originalNumber');
            const taskEl = document.getElementById('taskText');
            const answerInput = document.getElementById('answer');
            const submitBtn = document.getElementById('submitBtn');
            const hintBtn = document.getElementById('hintBtn');
            const skipBtn = document.getElementById('skipBtn');
            const startBtn = document.getElementById('startBtn');
            const restartBtn = document.getElementById('restartBtn');
            const feedbackEl = document.getElementById('feedback');
            const scoreEl = document.getElementById('score');
            const livesEl = document.getElementById('lives');
            const timerEl = document.getElementById('timer');
            const levelBadge = document.getElementById('levelBadge');
            const modal = document.getElementById('modal');
            const modalStart = document.getElementById('modalStart');
            const gameArea = document.getElementById('gameArea');
            const levelPopup = document.getElementById('levelPopup');
            const popupScore = document.getElementById('popupScore');
            const popupNext = document.getElementById('popupNext');
            const popupNextLevel = document.getElementById('popupNextLevel');

            // === GAME STATE ===
            let score = 0;
            let lives = 3;
            let level = 1;
            let round = 0;
            let timeLeft = 20; // 20 seconds for this two-step calculation
            let timerInterval = null;
            let current = null;
            let playing = false;

            // === UTILITIES ===
            function playSound(type) {
                console.log(`Playing sound: ${type}`);
            }

            // Function to convert a value from one unit to another
            function convertValue(value, fromUnit, toUnit) {
                const valueInMeters = value * CONVERSION_FACTORS[fromUnit];
                return valueInMeters / CONVERSION_FACTORS[toUnit];
            }

            // === RANDOM CHALLENGE GENERATOR ===
            function pickTaskForLevel(lvl) {
                // Base value (e.g., 0.1 to 999 meters)
                const baseValue = (Math.random() * 999) + 0.1;
                const fromUnit = UNITS[Math.floor(Math.random() * UNITS.length)];

                // Choose a target unit different from the starting unit
                let toUnit;
                do {
                    toUnit = UNITS[Math.floor(Math.random() * UNITS.length)];
                } while (fromUnit === toUnit);

                // Max decimal places increases with level
                const maxPlaces = Math.min(4, 1 + Math.floor(lvl / 2));
                const places = Math.floor(Math.random() * maxPlaces) + 1;

                return {
                    value: baseValue,
                    fromUnit: fromUnit,
                    toUnit: toUnit,
                    places: places
                };
            }

            // === UI UPDATERS ===
            function updateUI() {
                scoreEl.textContent = score;
                livesEl.textContent = lives;
                levelBadge.textContent = `Level ${level}`;
                livesEl.parentElement.classList.toggle('bg-red-300', lives === 1);
                livesEl.parentElement.classList.toggle('bg-red-100', lives > 1);
            }

            function updateTaskDisplay() {
                if (!current) return;

                // Display original value rounded to a reasonable length
                originalEl.textContent = `${Number(current.value.toPrecision(5)).toString()} ${current.fromUnit}`;

                taskEl.textContent =
                    `Convert ${current.fromUnit} to ${current.toUnit}, rounded to ${current.places} decimal place${current.places > 1 ? 's' : ''}.`;
            }

            // === ROUND FLOW & TIMER (Adapted from Decimal Dash) ===
            function startRound() {
                if (!playing) return;
                round++;
                answerInput.value = '';
                feedbackEl.textContent = 'Convert the unit and round the result!';
                feedbackEl.className = 'feedback';

                current = pickTaskForLevel(level);
                updateTaskDisplay();

                startTimer();
                answerInput.focus();

                submitBtn.disabled = false;
                hintBtn.disabled = false;
                skipBtn.disabled = false;
            }

            function startTimer() {
                stopTimer();
                timeLeft = Math.max(8, 20 - Math.floor(level / 2)); // 20s down to 8s max
                showTime();
                timerInterval = setInterval(() => {
                    timeLeft--;
                    showTime();
                    if (timeLeft <= 0) {
                        stopTimer();
                        onTimeOut();
                    }
                }, 1000);
            }

            function stopTimer() {
                if (timerInterval) clearInterval(timerInterval);
                timerInterval = null;
            }

            function showTime() {
                const mm = String(Math.floor(timeLeft / 60)).padStart(2, '0');
                const ss = String(timeLeft % 60).padStart(2, '0');
                timerEl.textContent = `${mm}:${ss}`;
                timerEl.classList.toggle('text-red-600', timeLeft <= 5);
            }

            // === CHECKING ANSWERS ===
            function expectedAnswerString(task) {
                // 1. Perform the conversion
                const convertedValue = convertValue(task.value, task.fromUnit, task.toUnit);
                // 2. Round the result
                return Number(convertedValue).toFixed(task.places);
            }

            function checkAnswer(userVal) {
                const expected = expectedAnswerString(current);
                // Check if the user's input string matches the correctly rounded, converted string
                return userVal.trim() === expected.trim();
            }

            function onCorrect() {
                stopTimer();
                playSound('success');
                score += 15 * level;
                feedbackEl.textContent = `‚úÖ Correct! Points earned: ${15 * level}`;
                feedbackEl.className = 'feedback success';
                updateUI();
                if (round % 5 === 0) levelUp();
                else nextTurnDelayed();
            }

            function onWrong() {
                stopTimer();
                playSound('fail');
                lives--;
                const ans = expectedAnswerString(current);
                feedbackEl.textContent = `‚ùå Wrong. Correct answer was: ${ans} ${current.toUnit}`;
                feedbackEl.className = 'feedback error';
                updateUI();
                nextTurnDelayed();
            }

            function onTimeOut() {
                stopTimer();
                playSound('fail');
                lives--;
                feedbackEl.textContent = `‚è∞ Time's up! Correct answer was: ${expectedAnswerString(current)} ${current.toUnit}`;
                feedbackEl.className = 'feedback error';
                updateUI();
                nextTurnDelayed();
            }

            function nextTurnDelayed() {
                submitBtn.disabled = true;
                hintBtn.disabled = true;
                skipBtn.disabled = true;

                if (lives <= 0) return setTimeout(endGame, 1500);

                setTimeout(() => {
                    startRound();
                }, 1500);
            }

            function startGame() {
                playing = true;
                score = 0;
                lives = 3;
                level = 1;
                round = 0;

                modalStart.classList.add('hidden');
                modal.classList.add('hidden');
                gameArea.classList.remove('hidden');

                updateUI();
                startRound();
            }

            function endGame() {
                stopTimer();
                playing = false;

                submitBtn.disabled = true;
                hintBtn.disabled = true;
                skipBtn.disabled = true;

                feedbackEl.textContent = `üíÄ Game Over! Final score: ${score}. Click Restart to try again.`;
                feedbackEl.className = 'feedback error';

                modal.classList.remove('hidden');
                gameArea.classList.add('hidden');
            }

            function levelUp() {
                stopTimer();
                level++;
                popupNextLevel.textContent = level;
                popupScore.textContent = score;
                levelPopup.classList.remove('hidden');
            }

            // === BUTTON ACTIONS AND EVENT LISTENERS (Adapted from Decimal Dash) ===

            // Game Start/Restart
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', startGame);

            // Level Up Popup
            popupNext.addEventListener('click', () => {
                levelPopup.classList.add('hidden');
                startRound();
            });

            // Submission Logic
            submitBtn.addEventListener('click', () => {
                if (!playing || submitBtn.disabled) return;
                const val = answerInput.value.trim();
                if (!val) {
                    feedbackEl.textContent = 'Please type a number.';
                    feedbackEl.className = 'feedback error';
                    return;
                }
                checkAnswer(val) ? onCorrect() : onWrong();
            });

            answerInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') submitBtn.click();
            });

            // --- HINT BUTTON (-5 points) ---
            hintBtn.addEventListener('click', () => {
                if (!playing || hintBtn.disabled) return;

                score = Math.max(0, score - 5);
                updateUI();
                hintBtn.disabled = true; // One hint per round

                const expected = expectedAnswerString(current);
                const convertedValue = convertValue(current.value, current.fromUnit, current.toUnit);

                // Hint: Show the value *before* rounding
                feedbackEl.textContent =
                    `üí° Hint: The converted value is ${convertedValue.toPrecision(7)} ${current.toUnit}. Now, round it to ${current.places} decimal place(s).`;
                feedbackEl.className = 'feedback error';

                // Give the user a bit of time back
                timeLeft = Math.max(5, timeLeft + 3);
                startTimer();
            });

            // --- SKIP BUTTON (-10 points) ---
            skipBtn.addEventListener('click', () => {
                if (!playing || skipBtn.disabled) return;

                stopTimer();

                score = Math.max(0, score - 10);
                updateUI();

                const ans = expectedAnswerString(current);
                feedbackEl.textContent = `‚è≠Ô∏è Skipped. The correct answer was: ${ans} ${current.toUnit}`;
                feedbackEl.className = 'feedback error';
                playSound('fail');

                nextTurnDelayed();
            });


            // Initial Setup
            document.addEventListener('DOMContentLoaded', () => {
                updateUI();

                gameArea.classList.add('hidden');
                modal.classList.add('hidden');
                modalStart.classList.remove('hidden');

                current = pickTaskForLevel(1);
                updateTaskDisplay();

                submitBtn.disabled = true;
                hintBtn.disabled = true;
                skipBtn.disabled = true;
            });

        })();
    </script>

</body>

</html>